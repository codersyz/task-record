{"version":3,"file":"calendar.js","sources":["pages/calendar/calendar.vue","pages/calendar/calendar.vue?type=page"],"sourcesContent":["<template>\n    <view class=\"container\">\n        <!-- 月份选择器 -->\n        <view class=\"month-selector\">\n            <view class=\"month-btn\" @click=\"prevMonth\">\n                <text class=\"arrow\">‹</text>\n            </view>\n            <view class=\"month-text\">\n                <text>{{ currentYear }}年{{ currentMonth }}月</text>\n            </view>\n            <view class=\"month-btn\" @click=\"nextMonth\">\n                <text class=\"arrow\">›</text>\n            </view>\n        </view>\n\n        <!-- 统计卡片 -->\n        <view class=\"stats-card\">\n            <view class=\"stat-item\">\n                <text class=\"stat-num\">{{ monthStats.totalDays }}</text>\n                <text class=\"stat-label\">本月打卡</text>\n            </view>\n            <view class=\"stat-item\">\n                <text class=\"stat-num\">{{ monthStats.continuousDays }}</text>\n                <text class=\"stat-label\">连续天数</text>\n            </view>\n            <view class=\"stat-item\">\n                <text class=\"stat-num\">{{ monthStats.completionRate }}%</text>\n                <text class=\"stat-label\">完成率</text>\n            </view>\n        </view>\n\n        <!-- 日历 -->\n        <view class=\"calendar-card\">\n            <!-- 星期标题 -->\n            <view class=\"weekdays\">\n                <text v-for=\"day in weekdays\" :key=\"day\" class=\"weekday\">{{ day }}</text>\n            </view>\n\n            <!-- 日期网格 -->\n            <view class=\"days-grid\">\n                <view v-for=\"(day, index) in calendarDays\" :key=\"index\" class=\"day-cell\" :class=\"{\n                    'other-month': !day.isCurrentMonth,\n                    'today': day.isToday,\n                    'has-checkin': day.hasCheckin\n                }\" @click=\"selectDate(day)\">\n                    <text class=\"day-num\">{{ day.day }}</text>\n                    <view v-if=\"day.hasCheckin\" class=\"checkin-dot\">\n                        <text class=\"dot-icon\">●</text>\n                    </view>\n                </view>\n            </view>\n        </view>\n\n        <!-- 当日打卡详情 -->\n        <view v-if=\"selectedDate && selectedDateCheckins.length > 0\" class=\"detail-card\">\n            <view class=\"detail-header\">\n                <text class=\"detail-title\">{{ selectedDate }}的打卡</text>\n            </view>\n            <view v-for=\"(item, index) in selectedDateCheckins\" :key=\"index\" class=\"checkin-item\">\n                <view class=\"checkin-header\">\n                    <view class=\"category-tag\" :class=\"'category-' + item.category\">\n                        <text>{{ getCategoryName(item.category) }}</text>\n                    </view>\n                    <text class=\"task-title\">{{ item.taskTitle }}</text>\n                </view>\n                <text v-if=\"item.note\" class=\"checkin-note\">{{ item.note }}</text>\n            </view>\n        </view>\n\n        <view v-else-if=\"selectedDate\" class=\"empty-detail\">\n            <text class=\"empty-text\">{{ selectedDate }}没有打卡记录</text>\n        </view>\n    </view>\n</template>\n\n<script>\nimport { getMonthlyCalendar } from '@/api/task';\n\nexport default {\n    data() {\n        return {\n            currentYear: new Date().getFullYear(),\n            currentMonth: new Date().getMonth() + 1,\n            weekdays: ['日', '一', '二', '三', '四', '五', '六'],\n            calendarDays: [],\n            checkinData: {},\n            selectedDate: null,\n            selectedDateCheckins: [],\n            monthStats: {\n                totalDays: 0,\n                continuousDays: 0,\n                completionRate: 0\n            }\n        };\n    },\n    onLoad() {\n        this.loadCalendarData();\n    },\n    methods: {\n        async loadCalendarData() {\n            try {\n                uni.showLoading({ title: '加载中...' });\n\n                const res = await getMonthlyCalendar(this.currentYear, this.currentMonth);\n\n                if (res.code === 200) {\n                    this.checkinData = res.data.checkins;\n                    this.generateCalendar();\n                    this.calculateMonthStats();\n                }\n\n                uni.hideLoading();\n            } catch (error) {\n                uni.hideLoading();\n                console.error('加载日历数据失败:', error);\n            }\n        },\n\n        generateCalendar() {\n            const year = this.currentYear;\n            const month = this.currentMonth;\n\n            // 当月第一天\n            const firstDay = new Date(year, month - 1, 1);\n            // 当月最后一天\n            const lastDay = new Date(year, month, 0);\n            // 当月天数\n            const daysInMonth = lastDay.getDate();\n            // 第一天是星期几\n            const firstDayWeek = firstDay.getDay();\n\n            const days = [];\n\n            // 填充上月日期\n            const prevMonthLastDay = new Date(year, month - 1, 0).getDate();\n            for (let i = firstDayWeek - 1; i >= 0; i--) {\n                days.push({\n                    day: prevMonthLastDay - i,\n                    isCurrentMonth: false,\n                    hasCheckin: false\n                });\n            }\n\n            // 填充当月日期\n            const today = new Date();\n            for (let i = 1; i <= daysInMonth; i++) {\n                const dateStr = `${year}-${String(month).padStart(2, '0')}-${String(i).padStart(2, '0')}`;\n                const isToday = year === today.getFullYear() &&\n                    month === today.getMonth() + 1 &&\n                    i === today.getDate();\n\n                days.push({\n                    day: i,\n                    date: dateStr,\n                    isCurrentMonth: true,\n                    isToday,\n                    hasCheckin: !!this.checkinData[dateStr]\n                });\n            }\n\n            // 填充下月日期\n            const remainingDays = 42 - days.length; // 6行7列\n            for (let i = 1; i <= remainingDays; i++) {\n                days.push({\n                    day: i,\n                    isCurrentMonth: false,\n                    hasCheckin: false\n                });\n            }\n\n            this.calendarDays = days;\n        },\n\n        calculateMonthStats() {\n            const checkinDates = Object.keys(this.checkinData);\n            this.monthStats.totalDays = checkinDates.length;\n\n            // 计算完成率（本月已过天数中的打卡率）\n            const today = new Date();\n            const daysInMonth = new Date(this.currentYear, this.currentMonth, 0).getDate();\n            let passedDays = daysInMonth;\n\n            if (this.currentYear === today.getFullYear() && this.currentMonth === today.getMonth() + 1) {\n                passedDays = today.getDate();\n            }\n\n            this.monthStats.completionRate = passedDays > 0\n                ? Math.round((checkinDates.length / passedDays) * 100)\n                : 0;\n\n            // 计算连续天数（从今天往前推）\n            this.monthStats.continuousDays = this.calculateContinuousDays(checkinDates);\n        },\n\n        calculateContinuousDays(checkinDates) {\n            if (checkinDates.length === 0) return 0;\n\n            // 获取今天的日期字符串（本地时区）\n            const today = new Date();\n            const todayStr = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;\n\n            let continuous = 0;\n            let checkDate = new Date(today);\n            checkDate.setHours(0, 0, 0, 0);\n\n            // 从今天开始往前检查连续打卡\n            while (true) {\n                const year = checkDate.getFullYear();\n                const month = String(checkDate.getMonth() + 1).padStart(2, '0');\n                const day = String(checkDate.getDate()).padStart(2, '0');\n                const dateStr = `${year}-${month}-${day}`;\n\n                if (checkinDates.includes(dateStr)) {\n                    continuous++;\n                    checkDate.setDate(checkDate.getDate() - 1);\n                } else {\n                    break;\n                }\n            }\n\n            return continuous;\n        },\n\n        selectDate(day) {\n            if (!day.isCurrentMonth || !day.hasCheckin) {\n                this.selectedDate = null;\n                this.selectedDateCheckins = [];\n                return;\n            }\n\n            this.selectedDate = `${this.currentMonth}月${day.day}日`;\n            this.selectedDateCheckins = this.checkinData[day.date] || [];\n        },\n\n        prevMonth() {\n            if (this.currentMonth === 1) {\n                this.currentYear--;\n                this.currentMonth = 12;\n            } else {\n                this.currentMonth--;\n            }\n            this.selectedDate = null;\n            this.selectedDateCheckins = [];\n            this.loadCalendarData();\n        },\n\n        nextMonth() {\n            if (this.currentMonth === 12) {\n                this.currentYear++;\n                this.currentMonth = 1;\n            } else {\n                this.currentMonth++;\n            }\n            this.selectedDate = null;\n            this.selectedDateCheckins = [];\n            this.loadCalendarData();\n        },\n\n        getCategoryName(category) {\n            const names = {\n                study: '学习',\n                sport: '运动',\n                read: '阅读',\n                health: '健康',\n                work: '工作',\n                other: '其他'\n            };\n            return names[category] || '其他';\n        }\n    }\n};\n</script>\n\n<style scoped>\n.container {\n    min-height: 100vh;\n    background: #F5F5F5;\n    padding: 20rpx;\n    padding-bottom: 100rpx;\n}\n\n.month-selector {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 30rpx 40rpx;\n    background: #FFFFFF;\n    border-radius: 16rpx;\n    margin-bottom: 20rpx;\n}\n\n.month-btn {\n    width: 60rpx;\n    height: 60rpx;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    background: #F5F5F5;\n    border-radius: 30rpx;\n}\n\n.arrow {\n    font-size: 40rpx;\n    color: #667eea;\n    font-weight: bold;\n}\n\n.month-text {\n    font-size: 32rpx;\n    font-weight: bold;\n    color: #333333;\n}\n\n.stats-card {\n    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n    border-radius: 16rpx;\n    padding: 30rpx;\n    display: flex;\n    justify-content: space-around;\n    margin-bottom: 20rpx;\n}\n\n.stat-item {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n}\n\n.stat-num {\n    font-size: 40rpx;\n    font-weight: bold;\n    color: #FFFFFF;\n}\n\n.stat-label {\n    font-size: 24rpx;\n    color: rgba(255, 255, 255, 0.8);\n    margin-top: 8rpx;\n}\n\n.calendar-card {\n    background: #FFFFFF;\n    border-radius: 16rpx;\n    padding: 30rpx;\n    margin-bottom: 20rpx;\n}\n\n.weekdays {\n    display: flex;\n    margin-bottom: 20rpx;\n}\n\n.weekday {\n    flex: 1;\n    text-align: center;\n    font-size: 24rpx;\n    color: #999999;\n    font-weight: bold;\n}\n\n.days-grid {\n    display: flex;\n    flex-wrap: wrap;\n}\n\n.day-cell {\n    width: 14.28%;\n    aspect-ratio: 1;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    position: relative;\n    margin-bottom: 10rpx;\n}\n\n.day-num {\n    font-size: 28rpx;\n    color: #333333;\n}\n\n.day-cell.other-month .day-num {\n    color: #CCCCCC;\n}\n\n.day-cell.today {\n    background: #E8F5E9;\n    border-radius: 50%;\n}\n\n.day-cell.today .day-num {\n    color: #4CAF50;\n    font-weight: bold;\n}\n\n.day-cell.has-checkin {\n    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n    border-radius: 50%;\n}\n\n.day-cell.has-checkin .day-num {\n    color: #FFFFFF;\n    font-weight: bold;\n}\n\n.checkin-dot {\n    position: absolute;\n    bottom: 5rpx;\n}\n\n.dot-icon {\n    font-size: 12rpx;\n    color: #FF9800;\n}\n\n.detail-card {\n    background: #FFFFFF;\n    border-radius: 16rpx;\n    padding: 30rpx;\n}\n\n.detail-header {\n    margin-bottom: 20rpx;\n}\n\n.detail-title {\n    font-size: 28rpx;\n    font-weight: bold;\n    color: #333333;\n}\n\n.checkin-item {\n    padding: 20rpx;\n    background: #F5F5F5;\n    border-radius: 12rpx;\n    margin-bottom: 15rpx;\n}\n\n.checkin-item:last-child {\n    margin-bottom: 0;\n}\n\n.checkin-header {\n    display: flex;\n    align-items: center;\n    margin-bottom: 10rpx;\n}\n\n.category-tag {\n    padding: 4rpx 12rpx;\n    border-radius: 8rpx;\n    font-size: 20rpx;\n    margin-right: 10rpx;\n}\n\n.category-study {\n    background: #E3F2FD;\n    color: #2196F3;\n}\n\n.category-sport {\n    background: #FFF3E0;\n    color: #FF9800;\n}\n\n.category-read {\n    background: #F3E5F5;\n    color: #9C27B0;\n}\n\n.category-health {\n    background: #E8F5E9;\n    color: #4CAF50;\n}\n\n.category-work {\n    background: #FBE9E7;\n    color: #FF5722;\n}\n\n.category-other {\n    background: #F5F5F5;\n    color: #757575;\n}\n\n.task-title {\n    font-size: 26rpx;\n    color: #333333;\n    flex: 1;\n}\n\n.checkin-note {\n    font-size: 24rpx;\n    color: #666666;\n    line-height: 1.6;\n}\n\n.empty-detail {\n    background: #FFFFFF;\n    border-radius: 16rpx;\n    padding: 60rpx;\n    text-align: center;\n}\n\n.empty-text {\n    font-size: 26rpx;\n    color: #999999;\n}\n</style>\n","import MiniProgramPage from '/Users/sunyizhong/uni-app/HBuilderProjects/taskuniapp/pages/calendar/calendar.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","getMonthlyCalendar"],"mappings":"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"}