{"version":3,"file":"profile-edit.js","sources":["pages/profile-edit.vue","pages/profile-edit.vue?type=page"],"sourcesContent":["<template>\n    <view class=\"container\">\n        <view class=\"title\">ÂÆåÂñÑ‰∏™‰∫∫‰ø°ÊÅØ</view>\n        <view class=\"subtitle\">ËØ∑Â°´ÂÜô‰Ω†ÁöÑÊòµÁß∞ÂíåÂ§¥ÂÉè</view>\n\n        <view class=\"form\">\n            <!-- Â§¥ÂÉèÈÄâÊã© -->\n            <view class=\"form-item\">\n                <text class=\"label\">Â§¥ÂÉè</text>\n                <button class=\"avatar-wrapper\" open-type=\"chooseAvatar\" @chooseavatar=\"onChooseAvatar\">\n                    <image class=\"avatar\" :src=\"getAvatarUrl(avatarUrl)\" mode=\"aspectFill\"></image>\n                    <text class=\"avatar-tip\">ÁÇπÂáªÊõ¥Êç¢Â§¥ÂÉè</text>\n                </button>\n            </view>\n\n            <!-- ÊòµÁß∞ËæìÂÖ• -->\n            <view class=\"form-item\">\n                <text class=\"label\">ÊòµÁß∞</text>\n                <input class=\"input\" type=\"nickname\" v-model=\"nickname\" placeholder=\"ËØ∑ËæìÂÖ•ÊòµÁß∞\" @blur=\"onNicknameBlur\" />\n            </view>\n        </view>\n\n        <view class=\"btn-group\">\n            <button class=\"submit-btn\" @click=\"handleSubmit\" :disabled=\"!canSubmit\">\n                ‰øùÂ≠ò\n            </button>\n            <button class=\"skip-btn\" @click=\"handleSkip\">\n                Ë∑≥Ëøá\n            </button>\n        </view>\n\n        <view class=\"tips\">\n            <text class=\"tip-text\">üí° ÊèêÁ§∫ÔºöÂ§¥ÂÉèÂíåÊòµÁß∞Áî®‰∫éÂú®Â∞èÁ®ãÂ∫è‰∏≠Â±ïÁ§∫‰Ω†ÁöÑ‰∏™‰∫∫‰ø°ÊÅØ</text>\n        </view>\n    </view>\n</template>\n\n<script>\nimport { updateUserInfo, getUserInfo } from '@/api/auth';\nimport { getAvatarUrl } from '@/utils/image';\n\nexport default {\n    data() {\n        return {\n            avatarUrl: '',\n            nickname: '',\n            fromLogin: false,\n            isLoading: true\n        };\n    },\n    computed: {\n        canSubmit() {\n            return this.nickname.trim().length > 0;\n        }\n    },\n    onLoad(options) {\n        this.fromLogin = options.fromLogin === 'true';\n        // Â¶ÇÊûú‰∏çÊòØ‰ªéÁôªÂΩïÈ°µÊù•ÁöÑÔºåÂä†ËΩΩÁé∞ÊúâÁî®Êà∑‰ø°ÊÅØ\n        if (!this.fromLogin) {\n            this.loadUserInfo();\n        } else {\n            this.isLoading = false;\n        }\n    },\n    methods: {\n        // Âä†ËΩΩÁî®Êà∑‰ø°ÊÅØ\n        async loadUserInfo() {\n            try {\n                const res = await getUserInfo();\n                if (res.code === 200) {\n                    this.nickname = res.data.nickname || '';\n                    this.avatarUrl = res.data.avatar_url || '';\n                    console.log('Âä†ËΩΩÁî®Êà∑‰ø°ÊÅØ:', res.data);\n                }\n            } catch (error) {\n                console.error('Âä†ËΩΩÁî®Êà∑‰ø°ÊÅØÂ§±Ë¥•:', error);\n            } finally {\n                this.isLoading = false;\n            }\n        },\n\n        // Ëé∑ÂèñÂÆåÊï¥ÁöÑÂ§¥ÂÉèURL\n        getAvatarUrl(avatarUrl) {\n            return getAvatarUrl(avatarUrl);\n        },\n\n        // ÈÄâÊã©Â§¥ÂÉè\n        onChooseAvatar(e) {\n            console.log('ÈÄâÊã©Â§¥ÂÉè:', e);\n            const { avatarUrl } = e.detail;\n            this.avatarUrl = avatarUrl;\n            console.log('Â§¥ÂÉèURL:', avatarUrl);\n        },\n\n        // ÊòµÁß∞ËæìÂÖ•ÂÆåÊàê\n        onNicknameBlur(e) {\n            console.log('ÊòµÁß∞ËæìÂÖ•:', e.detail.value);\n            this.nickname = e.detail.value;\n        },\n\n        // ‰∏ä‰º†Â§¥ÂÉèÂà∞ÊúçÂä°Âô®\n        async uploadAvatar(tempFilePath) {\n            return new Promise((resolve, reject) => {\n                const token = uni.getStorageSync('token');\n\n                // ÂºÄÂèëÁéØÂ¢É\n                // const baseURL = 'http://localhost:3003'; // ÂºÄÂèëËÄÖÂ∑•ÂÖ∑\n                // const baseURL = 'http://192.168.202.53:3003'; // ÁúüÊú∫Ë∞ÉËØï\n\n                // Áîü‰∫ßÁéØÂ¢ÉÔºàÂèëÂ∏ÉÊó∂ÂèñÊ∂àÊ≥®ÈáäÔºâ\n                const baseURL = 'https://syztools.cn/task-api';\n\n                uni.uploadFile({\n                    url: `${baseURL}/api/auth/upload-avatar`,\n                    filePath: tempFilePath,\n                    name: 'avatar',\n                    header: {\n                        'Authorization': `Bearer ${token}`\n                    },\n                    success: (uploadRes) => {\n                        console.log('‰∏ä‰º†ÂìçÂ∫î:', uploadRes);\n                        try {\n                            const data = JSON.parse(uploadRes.data);\n                            if (data.code === 200) {\n                                resolve(data.data.avatarUrl);\n                            } else {\n                                reject(new Error(data.message || '‰∏ä‰º†Â§±Ë¥•'));\n                            }\n                        } catch (e) {\n                            reject(new Error('Ëß£ÊûêÂìçÂ∫îÂ§±Ë¥•'));\n                        }\n                    },\n                    fail: (error) => {\n                        console.error('‰∏ä‰º†Â§±Ë¥•:', error);\n                        reject(error);\n                    }\n                });\n            });\n        },\n\n        // Êèê‰∫§\n        async handleSubmit() {\n            if (!this.canSubmit) {\n                uni.showToast({\n                    title: 'ËØ∑ËæìÂÖ•ÊòµÁß∞',\n                    icon: 'none'\n                });\n                return;\n            }\n\n            try {\n                uni.showLoading({\n                    title: '‰øùÂ≠ò‰∏≠...'\n                });\n\n                console.log('ÂáÜÂ§á‰øùÂ≠ò:', {\n                    nickname: this.nickname,\n                    avatarUrl: this.avatarUrl\n                });\n\n                // Â¶ÇÊûúÊúâÊñ∞ÈÄâÊã©ÁöÑÂ§¥ÂÉèÔºà‰∏¥Êó∂Ë∑ØÂæÑÔºâÔºåÂÖà‰∏ä‰º†Âà∞ÊúçÂä°Âô®\n                let finalAvatarUrl = this.avatarUrl;\n                if (this.avatarUrl && (this.avatarUrl.startsWith('http://tmp/') || this.avatarUrl.startsWith('wxfile://'))) {\n                    try {\n                        console.log('‰∏ä‰º†‰∏¥Êó∂Â§¥ÂÉèÂà∞ÊúçÂä°Âô®...');\n                        finalAvatarUrl = await this.uploadAvatar(this.avatarUrl);\n                        console.log('Â§¥ÂÉè‰∏ä‰º†ÊàêÂäü:', finalAvatarUrl);\n                    } catch (uploadError) {\n                        console.error('Â§¥ÂÉè‰∏ä‰º†Â§±Ë¥•:', uploadError);\n                        uni.hideLoading();\n                        uni.showToast({\n                            title: 'Â§¥ÂÉè‰∏ä‰º†Â§±Ë¥•',\n                            icon: 'none'\n                        });\n                        return;\n                    }\n                } else if (this.avatarUrl && this.avatarUrl.startsWith('/uploads/')) {\n                    // Â¶ÇÊûúÊòØÂ∑≤Áªè‰∏ä‰º†ÁöÑÂ§¥ÂÉèË∑ØÂæÑÔºåÁõ¥Êé•‰ΩøÁî®\n                    finalAvatarUrl = this.avatarUrl;\n                    console.log('‰ΩøÁî®Â∑≤ÊúâÂ§¥ÂÉè:', finalAvatarUrl);\n                }\n\n                // Êõ¥Êñ∞Áî®Êà∑‰ø°ÊÅØ\n                const res = await updateUserInfo({\n                    nickname: this.nickname,\n                    avatarUrl: finalAvatarUrl || '/static/logo.webp'\n                });\n\n                uni.hideLoading();\n\n                if (res.code === 200) {\n                    uni.showToast({\n                        title: '‰øùÂ≠òÊàêÂäü',\n                        icon: 'success'\n                    });\n\n                    setTimeout(() => {\n                        if (this.fromLogin) {\n                            // ‰ªéÁôªÂΩïÈ°µÊù•ÁöÑÔºåË∑≥ËΩ¨Âà∞È¶ñÈ°µ\n                            uni.switchTab({\n                                url: '/pages/index/index'\n                            });\n                        } else {\n                            // ‰ªé‰∏™‰∫∫‰∏≠ÂøÉÊù•ÁöÑÔºåËøîÂõû\n                            uni.navigateBack();\n                        }\n                    }, 1000);\n                } else {\n                    uni.showToast({\n                        title: res.message || '‰øùÂ≠òÂ§±Ë¥•',\n                        icon: 'none'\n                    });\n                }\n            } catch (error) {\n                uni.hideLoading();\n                console.error('‰øùÂ≠òÂ§±Ë¥•:', error);\n                uni.showToast({\n                    title: '‰øùÂ≠òÂ§±Ë¥•',\n                    icon: 'none'\n                });\n            }\n        },\n\n        // Ë∑≥Ëøá\n        handleSkip() {\n            if (this.fromLogin) {\n                uni.switchTab({\n                    url: '/pages/index/index'\n                });\n            } else {\n                uni.navigateBack();\n            }\n        }\n    }\n};\n</script>\n\n<style scoped>\n.container {\n    min-height: 100vh;\n    background: #F5F5F5;\n    padding: 40rpx;\n}\n\n.title {\n    font-size: 40rpx;\n    font-weight: bold;\n    color: #333333;\n    text-align: center;\n    margin-bottom: 20rpx;\n}\n\n.subtitle {\n    font-size: 28rpx;\n    color: #999999;\n    text-align: center;\n    margin-bottom: 60rpx;\n}\n\n.form {\n    background: #FFFFFF;\n    border-radius: 16rpx;\n    padding: 40rpx;\n    margin-bottom: 40rpx;\n}\n\n.form-item {\n    margin-bottom: 40rpx;\n}\n\n.form-item:last-child {\n    margin-bottom: 0;\n}\n\n.label {\n    display: block;\n    font-size: 28rpx;\n    color: #333333;\n    margin-bottom: 20rpx;\n    font-weight: bold;\n}\n\n.avatar-wrapper {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    padding: 40rpx;\n    background: #F5F5F5;\n    border-radius: 16rpx;\n    border: none;\n}\n\n.avatar {\n    width: 160rpx;\n    height: 160rpx;\n    border-radius: 80rpx;\n    margin-bottom: 20rpx;\n}\n\n.avatar-tip {\n    font-size: 24rpx;\n    color: #999999;\n}\n\n.input {\n    width: 100%;\n    height: 80rpx;\n    background: #F5F5F5;\n    border-radius: 8rpx;\n    padding: 0 20rpx;\n    font-size: 28rpx;\n}\n\n.btn-group {\n    margin-bottom: 40rpx;\n}\n\n.submit-btn {\n    width: 100%;\n    height: 88rpx;\n    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n    color: #FFFFFF;\n    border-radius: 44rpx;\n    font-size: 32rpx;\n    border: none;\n    margin-bottom: 20rpx;\n}\n\n.submit-btn[disabled] {\n    background: #CCCCCC;\n}\n\n.skip-btn {\n    width: 100%;\n    height: 88rpx;\n    background: #FFFFFF;\n    color: #666666;\n    border-radius: 44rpx;\n    font-size: 28rpx;\n    border: 1rpx solid #E0E0E0;\n}\n\n.tips {\n    padding: 20rpx;\n}\n\n.tip-text {\n    font-size: 24rpx;\n    color: #999999;\n    line-height: 1.6;\n}\n</style>\n","import MiniProgramPage from '/Users/sunyizhong/uni-app/HBuilderProjects/taskuniapp/pages/profile-edit.vue'\nwx.createPage(MiniProgramPage)"],"names":["getUserInfo","uni","getAvatarUrl","updateUserInfo"],"mappings":"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"}