{"version":3,"file":"index.js","sources":["pages/index/index.vue","pages/index/index.vue?type=page"],"sourcesContent":["<template>\r\n\t<view class=\"container\">\r\n\t\t<!-- 顶部统计 - 固定 -->\r\n\t\t<view class=\"stats-card\">\r\n\t\t\t<view class=\"stat-item\">\r\n\t\t\t\t<text class=\"stat-num\">{{ taskStats.total }}</text>\r\n\t\t\t\t<text class=\"stat-label\">总任务</text>\r\n\t\t\t</view>\r\n\t\t\t<view class=\"stat-item\">\r\n\t\t\t\t<text class=\"stat-num\">{{ taskStats.active }}</text>\r\n\t\t\t\t<text class=\"stat-label\">进行中</text>\r\n\t\t\t</view>\r\n\t\t\t<view class=\"stat-item\">\r\n\t\t\t\t<text class=\"stat-num\">{{ taskStats.totalCheckins }}</text>\r\n\t\t\t\t<text class=\"stat-label\">累计打卡</text>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\r\n\t\t<!-- 任务列表 - 可滚动 -->\r\n\t\t<scroll-view class=\"task-scroll\" scroll-y>\r\n\t\t\t<view class=\"task-list\">\r\n\t\t\t\t<view v-if=\"taskList.length === 0\" class=\"empty\">\r\n\t\t\t\t\t<text class=\"empty-text\">暂无任务，点击下方按钮创建</text>\r\n\t\t\t\t</view>\r\n\r\n\t\t\t\t<view v-for=\"task in taskList\" :key=\"task.id\" class=\"task-item\" @click=\"goToDetail(task.id)\">\r\n\t\t\t\t\t<view class=\"task-header\">\r\n\t\t\t\t\t\t<view class=\"title-row\">\r\n\t\t\t\t\t\t\t<view class=\"category-tag\" :class=\"'category-' + task.category\">\r\n\t\t\t\t\t\t\t\t<text>{{ getCategoryName(task.category) }}</text>\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t<text class=\"task-title\">{{ task.title }}</text>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t<text class=\"task-status\" :class=\"task.status === 1 ? 'active' : 'completed'\">\r\n\t\t\t\t\t\t\t{{ task.status === 1 ? '进行中' : '已完成' }}\r\n\t\t\t\t\t\t</text>\r\n\t\t\t\t\t</view>\r\n\r\n\t\t\t\t\t<view class=\"task-progress\">\r\n\t\t\t\t\t\t<text class=\"progress-text\">连续 {{ task.current_days }} 天</text>\r\n\t\t\t\t\t\t<text class=\"progress-text\">累计 {{ task.total_days }} 天</text>\r\n\t\t\t\t\t</view>\r\n\r\n\t\t\t\t\t<view v-if=\"task.target_days > 0\" class=\"task-target\">\r\n\t\t\t\t\t\t<text class=\"target-text\">目标: {{ task.target_days }} 天</text>\r\n\t\t\t\t\t\t<view class=\"progress-bar\">\r\n\t\t\t\t\t\t\t<view class=\"progress-fill\" :style=\"{ width: getProgress(task) + '%' }\"></view>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</scroll-view>\r\n\r\n\t\t<!-- 创建按钮 -->\r\n\t\t<view class=\"create-btn\" @click=\"goToCreate\">\r\n\t\t\t<text class=\"iconfont icon-jia\"></text>\r\n\t\t</view>\r\n\r\n\t\t<!-- 自定义 TabBar -->\r\n\t\t<custom-tabbar />\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\nimport customTabbar from '@/components/custom-tabbar/custom-tabbar.vue';\r\nimport { getTaskList } from '@/api/task';\r\n\r\nexport default {\r\n\tcomponents: {\r\n\t\tcustomTabbar\r\n\t},\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\ttaskList: [],\r\n\t\t\ttaskStats: {\r\n\t\t\t\ttotal: 0,\r\n\t\t\t\tactive: 0,\r\n\t\t\t\ttotalCheckins: 0\r\n\t\t\t}\r\n\t\t};\r\n\t},\r\n\tonShow() {\r\n\t\t// 开发阶段：如果没有token，先不加载数据，但不强制跳转\r\n\t\tconst token = uni.getStorageSync('token');\r\n\t\tconst userId = uni.getStorageSync('userId');\r\n\r\n\t\tconsole.log('=== 首页加载 ===');\r\n\t\tconsole.log('Token:', token ? token.substring(0, 20) + '...' : '无');\r\n\t\tconsole.log('UserId:', userId);\r\n\r\n\t\tif (token) {\r\n\t\t\tthis.loadTaskList();\r\n\t\t} else {\r\n\t\t\t// 提示用户需要登录\r\n\t\t\tuni.showModal({\r\n\t\t\t\ttitle: '提示',\r\n\t\t\t\tcontent: '请先登录',\r\n\t\t\t\tshowCancel: false,\r\n\t\t\t\tsuccess: () => {\r\n\t\t\t\t\tuni.reLaunch({\r\n\t\t\t\t\t\turl: '/pages/login/login'\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t},\r\n\tmethods: {\r\n\t\tasync loadTaskList() {\r\n\t\t\ttry {\r\n\t\t\t\tconsole.log('开始加载任务列表...');\r\n\t\t\t\tconst res = await getTaskList();\r\n\t\t\t\tconsole.log('任务列表响应:', res);\r\n\r\n\t\t\t\tif (res.code === 200) {\r\n\t\t\t\t\tthis.taskList = res.data;\r\n\t\t\t\t\tconsole.log('任务列表数据:', this.taskList);\r\n\t\t\t\t\tthis.calculateStats();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconsole.error('获取任务列表失败:', res);\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: res.message || '获取任务失败',\r\n\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t} catch (error) {\r\n\t\t\t\tconsole.error('加载任务列表错误:', error);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tcalculateStats() {\r\n\t\t\tthis.taskStats.total = this.taskList.length;\r\n\t\t\tthis.taskStats.active = this.taskList.filter(t => t.status === 1).length;\r\n\t\t\tthis.taskStats.totalCheckins = this.taskList.reduce((sum, t) => sum + t.total_days, 0);\r\n\t\t},\r\n\r\n\t\tgetProgress(task) {\r\n\t\t\tif (task.target_days === 0) return 0;\r\n\t\t\treturn Math.min((task.total_days / task.target_days) * 100, 100);\r\n\t\t},\r\n\r\n\t\tgoToDetail(id) {\r\n\t\t\tuni.navigateTo({\r\n\t\t\t\turl: `/pages/task/detail?id=${id}`\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tgoToCreate() {\r\n\t\t\tuni.navigateTo({\r\n\t\t\t\turl: '/pages/task/create'\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tgetCategoryName(category) {\r\n\t\t\tconst names = {\r\n\t\t\t\tstudy: '学习',\r\n\t\t\t\tsport: '运动',\r\n\t\t\t\tread: '阅读',\r\n\t\t\t\thealth: '健康',\r\n\t\t\t\twork: '工作',\r\n\t\t\t\tother: '其他'\r\n\t\t\t};\r\n\t\t\treturn names[category] || '其他';\r\n\t\t}\r\n\t}\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.container {\r\n\theight: 100vh;\r\n\tdisplay: flex;\r\n\tflex-direction: column;\r\n\tbackground: #F5F5F5;\r\n}\r\n\r\n.stats-card {\r\n\tbackground: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\r\n\tpadding: 40rpx;\r\n\tdisplay: flex;\r\n\tjustify-content: space-around;\r\n\tflex-shrink: 0;\r\n}\r\n\r\n.stat-item {\r\n\tdisplay: flex;\r\n\tflex-direction: column;\r\n\talign-items: center;\r\n}\r\n\r\n.stat-num {\r\n\tfont-size: 48rpx;\r\n\tfont-weight: bold;\r\n\tcolor: #FFFFFF;\r\n}\r\n\r\n.stat-label {\r\n\tfont-size: 24rpx;\r\n\tcolor: rgba(255, 255, 255, 0.8);\r\n\tmargin-top: 10rpx;\r\n}\r\n\r\n.task-scroll {\r\n\tflex: 1;\r\n\theight: 0;\r\n}\r\n\r\n.task-list {\r\n\tpadding: 20rpx;\r\n\tpadding-bottom: 180rpx;\r\n}\r\n\r\n.empty {\r\n\ttext-align: center;\r\n\tpadding: 100rpx 0;\r\n}\r\n\r\n.empty-text {\r\n\tfont-size: 28rpx;\r\n\tcolor: #999999;\r\n}\r\n\r\n.task-item {\r\n\tbackground: #FFFFFF;\r\n\tborder-radius: 16rpx;\r\n\tpadding: 30rpx;\r\n\tmargin-bottom: 20rpx;\r\n\tbox-shadow: 0 2rpx 12rpx rgba(0, 0, 0, 0.08);\r\n}\r\n\r\n.task-header {\r\n\tdisplay: flex;\r\n\tjustify-content: space-between;\r\n\talign-items: flex-start;\r\n\tmargin-bottom: 20rpx;\r\n}\r\n\r\n.title-row {\r\n\tdisplay: flex;\r\n\talign-items: center;\r\n\tflex: 1;\r\n\tflex-wrap: wrap;\r\n}\r\n\r\n.category-tag {\r\n\tpadding: 4rpx 12rpx;\r\n\tborder-radius: 8rpx;\r\n\tfont-size: 20rpx;\r\n\tmargin-right: 10rpx;\r\n\tflex-shrink: 0;\r\n}\r\n\r\n.category-study {\r\n\tbackground: #E3F2FD;\r\n\tcolor: #2196F3;\r\n}\r\n\r\n.category-sport {\r\n\tbackground: #FFF3E0;\r\n\tcolor: #FF9800;\r\n}\r\n\r\n.category-read {\r\n\tbackground: #F3E5F5;\r\n\tcolor: #9C27B0;\r\n}\r\n\r\n.category-health {\r\n\tbackground: #E8F5E9;\r\n\tcolor: #4CAF50;\r\n}\r\n\r\n.category-work {\r\n\tbackground: #FBE9E7;\r\n\tcolor: #FF5722;\r\n}\r\n\r\n.category-other {\r\n\tbackground: #F5F5F5;\r\n\tcolor: #757575;\r\n}\r\n\r\n.task-title {\r\n\tfont-size: 32rpx;\r\n\tfont-weight: bold;\r\n\tcolor: #333333;\r\n\tflex: 1;\r\n}\r\n\r\n.task-status {\r\n\tfont-size: 24rpx;\r\n\tpadding: 8rpx 16rpx;\r\n\tborder-radius: 20rpx;\r\n}\r\n\r\n.task-status.active {\r\n\tbackground: #E8F5E9;\r\n\tcolor: #4CAF50;\r\n}\r\n\r\n.task-status.completed {\r\n\tbackground: #E3F2FD;\r\n\tcolor: #2196F3;\r\n}\r\n\r\n.task-progress {\r\n\tdisplay: flex;\r\n\tgap: 30rpx;\r\n\tmargin-bottom: 20rpx;\r\n}\r\n\r\n.progress-text {\r\n\tfont-size: 28rpx;\r\n\tcolor: #666666;\r\n}\r\n\r\n.task-target {\r\n\tmargin-top: 20rpx;\r\n}\r\n\r\n.target-text {\r\n\tfont-size: 24rpx;\r\n\tcolor: #999999;\r\n}\r\n\r\n.progress-bar {\r\n\theight: 8rpx;\r\n\tbackground: #E0E0E0;\r\n\tborder-radius: 4rpx;\r\n\tmargin-top: 10rpx;\r\n\toverflow: hidden;\r\n}\r\n\r\n.progress-fill {\r\n\theight: 100%;\r\n\tbackground: linear-gradient(90deg, #667eea 0%, #764ba2 100%);\r\n\ttransition: width 0.3s;\r\n}\r\n\r\n.create-btn {\r\n\tposition: fixed;\r\n\tright: 40rpx;\r\n\tbottom: 180rpx;\r\n\twidth: 100rpx;\r\n\theight: 100rpx;\r\n\tbackground: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\r\n\tborder-radius: 50%;\r\n\tdisplay: flex;\r\n\talign-items: center;\r\n\tjustify-content: center;\r\n\tbox-shadow: 0 4rpx 20rpx rgba(102, 126, 234, 0.4);\r\n\tz-index: 100;\r\n}\r\n\r\n.create-btn .iconfont {\r\n\tfont-size: 36rpx;\r\n\tcolor: #FFFFFF;\r\n\tline-height: 1;\r\n}\r\n</style>\r\n","import MiniProgramPage from '/Users/sunyizhong/uni-app/HBuilderProjects/taskuniapp/pages/index/index.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","getTaskList"],"mappings":";;;AAgEA,MAAO,eAAc,MAAW;AAGhC,MAAK,YAAU;AAAA,EACd,YAAY;AAAA,IACX;AAAA,EACA;AAAA,EACD,OAAO;AACN,WAAO;AAAA,MACN,UAAU,CAAE;AAAA,MACZ,WAAW;AAAA,QACV,OAAO;AAAA,QACP,QAAQ;AAAA,QACR,eAAe;AAAA,MAChB;AAAA;EAED;AAAA,EACD,SAAS;AAER,UAAM,QAAQA,cAAAA,MAAI,eAAe,OAAO;AACxC,UAAM,SAASA,cAAAA,MAAI,eAAe,QAAQ;AAE1CA,kBAAAA,MAAY,MAAA,OAAA,+BAAA,cAAc;AAC1BA,kBAAAA,MAAY,MAAA,OAAA,+BAAA,UAAU,QAAQ,MAAM,UAAU,GAAG,EAAE,IAAI,QAAQ,GAAG;AAClEA,oEAAY,WAAW,MAAM;AAE7B,QAAI,OAAO;AACV,WAAK,aAAY;AAAA,WACX;AAENA,oBAAAA,MAAI,UAAU;AAAA,QACb,OAAO;AAAA,QACP,SAAS;AAAA,QACT,YAAY;AAAA,QACZ,SAAS,MAAM;AACdA,wBAAAA,MAAI,SAAS;AAAA,YACZ,KAAK;AAAA,UACN,CAAC;AAAA,QACF;AAAA,MACD,CAAC;AAAA,IACF;AAAA,EACA;AAAA,EACD,SAAS;AAAA,IACR,MAAM,eAAe;AACpB,UAAI;AACHA,sBAAAA,mDAAY,aAAa;AACzB,cAAM,MAAM,MAAMC,SAAAA;AAClBD,sBAAA,MAAA,MAAA,OAAA,gCAAY,WAAW,GAAG;AAE1B,YAAI,IAAI,SAAS,KAAK;AACrB,eAAK,WAAW,IAAI;AACpBA,wBAAY,MAAA,MAAA,OAAA,gCAAA,WAAW,KAAK,QAAQ;AACpC,eAAK,eAAc;AAAA,eACb;AACNA,6EAAc,aAAa,GAAG;AAC9BA,wBAAAA,MAAI,UAAU;AAAA,YACb,OAAO,IAAI,WAAW;AAAA,YACtB,MAAM;AAAA,UACP,CAAC;AAAA,QACF;AAAA,MACC,SAAO,OAAO;AACfA,sBAAc,MAAA,MAAA,SAAA,gCAAA,aAAa,KAAK;AAAA,MACjC;AAAA,IACA;AAAA,IAED,iBAAiB;AAChB,WAAK,UAAU,QAAQ,KAAK,SAAS;AACrC,WAAK,UAAU,SAAS,KAAK,SAAS,OAAO,OAAK,EAAE,WAAW,CAAC,EAAE;AAClE,WAAK,UAAU,gBAAgB,KAAK,SAAS,OAAO,CAAC,KAAK,MAAM,MAAM,EAAE,YAAY,CAAC;AAAA,IACrF;AAAA,IAED,YAAY,MAAM;AACjB,UAAI,KAAK,gBAAgB;AAAG,eAAO;AACnC,aAAO,KAAK,IAAK,KAAK,aAAa,KAAK,cAAe,KAAK,GAAG;AAAA,IAC/D;AAAA,IAED,WAAW,IAAI;AACdA,oBAAAA,MAAI,WAAW;AAAA,QACd,KAAK,yBAAyB,EAAE;AAAA,MACjC,CAAC;AAAA,IACD;AAAA,IAED,aAAa;AACZA,oBAAAA,MAAI,WAAW;AAAA,QACd,KAAK;AAAA,MACN,CAAC;AAAA,IACD;AAAA,IAED,gBAAgB,UAAU;AACzB,YAAM,QAAQ;AAAA,QACb,OAAO;AAAA,QACP,OAAO;AAAA,QACP,MAAM;AAAA,QACN,QAAQ;AAAA,QACR,MAAM;AAAA,QACN,OAAO;AAAA;AAER,aAAO,MAAM,QAAQ,KAAK;AAAA,IAC3B;AAAA,EACD;AACD;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACnKA,GAAG,WAAW,eAAe;"}