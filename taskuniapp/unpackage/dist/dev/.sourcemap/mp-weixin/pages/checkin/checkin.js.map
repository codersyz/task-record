{"version":3,"file":"checkin.js","sources":["pages/checkin/checkin.vue","pages/checkin/checkin.vue?type=page"],"sourcesContent":["<template>\n    <view class=\"container\">\n        <view class=\"form\">\n            <view class=\"form-item\">\n                <text class=\"label\">ÊâìÂç°Â§áÊ≥®</text>\n                <textarea class=\"textarea\" v-model=\"note\" placeholder=\"ËÆ∞ÂΩï‰ªäÂ§©ÁöÑÊî∂Ëé∑...\" maxlength=\"200\" />\n            </view>\n        </view>\n\n        <view class=\"btn-group\">\n            <button class=\"submit-btn\" type=\"primary\" @click=\"handleCheckin\" :loading=\"loading\">\n                Á°ÆËÆ§ÊâìÂç°\n            </button>\n        </view>\n    </view>\n</template>\n\n<script>\nimport { checkin } from '@/api/task';\n\nexport default {\n    data() {\n        return {\n            taskId: 0,\n            note: '',\n            loading: false,\n            hasCheckedToday: false\n        };\n    },\n    onLoad(options) {\n        this.taskId = options.taskId;\n        this.hasCheckedToday = options.hasChecked === 'true';\n\n        // Â¶ÇÊûúÂ∑≤ÁªèÊâìÂç°ÔºåÁõ¥Êé•ÊèêÁ§∫Âπ∂ËøîÂõû\n        if (this.hasCheckedToday) {\n            uni.showModal({\n                title: 'ÊèêÁ§∫',\n                content: '‰ªäÂ§©Â∑≤ÁªèÊâìÂç°Ëøá‰∫Ü',\n                showCancel: false,\n                success: () => {\n                    uni.navigateBack();\n                }\n            });\n        }\n    },\n    methods: {\n        async handleCheckin() {\n            this.loading = true;\n\n            try {\n                const res = await checkin({\n                    taskId: this.taskId,\n                    note: this.note\n                });\n\n                if (res.code === 200) {\n                    // ÊûÑÂª∫ÊàêÂäüÊ∂àÊÅØ\n                    let successMsg = `ÊâìÂç°ÊàêÂäüÔºÅËøûÁª≠${res.data.currentDays}Â§©`;\n\n                    // Ê£ÄÊü•ÁßØÂàÜÂ•ñÂä±\n                    if (res.data.points && res.data.points.total > 0) {\n                        const points = res.data.points;\n                        let pointsMsg = `\\n\\nüíé Ëé∑Âæó ${points.total} ÁßØÂàÜ`;\n\n                        if (points.daily > 0) {\n                            pointsMsg += `\\n‚ú® ÊØèÊó•È¶ñÊ¨°ÊâìÂç° +${points.daily}`;\n                        }\n                        if (points.streak7 > 0) {\n                            pointsMsg += `\\nüî• ËøûÁª≠${points.consecutiveDays}Â§©Â•ñÂä± +${points.streak7}`;\n                        }\n                        if (points.streak30 > 0) {\n                            pointsMsg += `\\n‚≠ê ËøûÁª≠${points.consecutiveDays}Â§©Â•ñÂä± +${points.streak30}`;\n                        }\n\n                        successMsg += pointsMsg;\n                    }\n\n                    // Ê£ÄÊü•ÊòØÂê¶ÂÆåÊàêÁõÆÊ†á\n                    if (res.data.isCompleted) {\n                        uni.showModal({\n                            title: 'üéâ ÊÅ≠Âñú',\n                            content: 'ÊâìÂç°ÊàêÂäüÔºÅ‰Ω†Â∑≤ÂÆåÊàêÁõÆÊ†á‰ªªÂä°ÔºÅ' + (res.data.points && res.data.points.total > 0 ? `\\n\\nüíé Ëé∑Âæó ${res.data.points.total} ÁßØÂàÜ` : ''),\n                            showCancel: false,\n                            success: () => {\n                                // Ê£ÄÊü•ÊòØÂê¶ÊúâÊñ∞ÊàêÂ∞±\n                                if (res.data.newAchievements && res.data.newAchievements.length > 0) {\n                                    this.showNewAchievements(res.data.newAchievements);\n                                } else {\n                                    uni.navigateBack();\n                                }\n                            }\n                        });\n                    } else {\n                        // ÊòæÁ§∫ÁßØÂàÜÂ•ñÂä±ÂºπÁ™ó\n                        if (res.data.points && res.data.points.total > 0) {\n                            uni.showModal({\n                                title: '‚úÖ ÊâìÂç°ÊàêÂäü',\n                                content: successMsg,\n                                showCancel: false,\n                                success: () => {\n                                    // Ê£ÄÊü•ÊòØÂê¶ÊúâÊñ∞ÊàêÂ∞±\n                                    if (res.data.newAchievements && res.data.newAchievements.length > 0) {\n                                        this.showNewAchievements(res.data.newAchievements);\n                                    } else {\n                                        uni.navigateBack();\n                                    }\n                                }\n                            });\n                        } else {\n                            uni.showToast({\n                                title: successMsg,\n                                icon: 'success'\n                            });\n\n                            setTimeout(() => {\n                                // Ê£ÄÊü•ÊòØÂê¶ÊúâÊñ∞ÊàêÂ∞±\n                                if (res.data.newAchievements && res.data.newAchievements.length > 0) {\n                                    this.showNewAchievements(res.data.newAchievements);\n                                } else {\n                                    uni.navigateBack();\n                                }\n                            }, 1500);\n                        }\n                    }\n                } else if (res.code === 1001) {\n                    // ‰ªäÂ§©Â∑≤ÁªèÊâìÂç°Ëøá‰∫Ü\n                    uni.showModal({\n                        title: 'ÊèêÁ§∫',\n                        content: res.message,\n                        showCancel: false,\n                        success: () => {\n                            uni.navigateBack();\n                        }\n                    });\n                } else {\n                    uni.showToast({\n                        title: res.message || 'ÊâìÂç°Â§±Ë¥•',\n                        icon: 'none'\n                    });\n                }\n            } catch (error) {\n                console.error('ÊâìÂç°Â§±Ë¥•:', error);\n                uni.showToast({\n                    title: 'ÊâìÂç°Â§±Ë¥•ÔºåËØ∑ÈáçËØï',\n                    icon: 'none'\n                });\n            } finally {\n                this.loading = false;\n            }\n        },\n\n        // ÊòæÁ§∫Êñ∞Ëß£ÈîÅÁöÑÊàêÂ∞±\n        showNewAchievements(achievements) {\n            const achievementNames = achievements.map(a => `${a.icon} ${a.name}`).join('\\n');\n            uni.showModal({\n                title: 'üéâ Ëß£ÈîÅÊñ∞ÊàêÂ∞±',\n                content: achievementNames,\n                confirmText: 'Êü•ÁúãÊàêÂ∞±',\n                cancelText: 'Á®çÂêéÊü•Áúã',\n                success: (res) => {\n                    if (res.confirm) {\n                        uni.redirectTo({\n                            url: '/pages/achievement/achievement'\n                        });\n                    } else {\n                        uni.navigateBack();\n                    }\n                }\n            });\n        }\n    }\n};\n</script>\n\n<style scoped>\n.container {\n    min-height: 100vh;\n    background: #F5F5F5;\n    padding: 20rpx;\n}\n\n.form {\n    background: #FFFFFF;\n    border-radius: 16rpx;\n    padding: 30rpx;\n}\n\n.form-item {\n    margin-bottom: 40rpx;\n}\n\n.label {\n    display: block;\n    font-size: 28rpx;\n    color: #333333;\n    margin-bottom: 20rpx;\n    font-weight: bold;\n}\n\n.textarea {\n    width: 100%;\n    min-height: 300rpx;\n    background: #F5F5F5;\n    border-radius: 8rpx;\n    padding: 20rpx;\n    font-size: 28rpx;\n}\n\n.btn-group {\n    margin-top: 40rpx;\n}\n\n.submit-btn {\n    width: 100%;\n    height: 88rpx;\n    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n    color: #FFFFFF;\n    border-radius: 44rpx;\n    font-size: 32rpx;\n    border: none;\n}\n</style>\n","import MiniProgramPage from '/Users/sunyizhong/uni-app/HBuilderProjects/taskuniapp/pages/checkin/checkin.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","checkin"],"mappings":"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"}